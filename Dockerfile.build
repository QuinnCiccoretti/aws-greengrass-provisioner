FROM ubuntu:18.04

# Update package manager
RUN apt-get update -y && apt-get upgrade -y

# Install JDK so Java functions can be built
RUN apt-get install -y openjdk-8-jdk-headless

COPY build.gradle /build/
COPY gradlew /build/
COPY gradle/wrapper/ /build/gradle/wrapper
WORKDIR /build/

# Run clean to at least fetch gradle
RUN ./gradlew clean

# Fetch dependencies
RUN ./gradlew resolveDependencies

# Fetch binaries
RUN ./gradlew downloadAll

COPY src /build/src
RUN ./gradlew build
